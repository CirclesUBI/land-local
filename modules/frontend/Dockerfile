FROM node:latest as builder

ARG API_ENDPOINT
ENV API_ENDPOINT=$API_ENDPOINT

ARG DEFAULT_APP_LANGUAGE
ENV DEFAULT_APP_LANGUAGE=$DEFAULT_APP_LANGUAGE

ARG CIRCLES_SUBGRAPH_ENDPOINT
ENV CIRCLES_SUBGRAPH_ENDPOINT=$CIRCLES_SUBGRAPH_ENDPOINT

ARG PATHFINDER_ENDPOINT
ENV PATHFINDER_ENDPOINT=$PATHFINDER_ENDPOINT

ARG CIRCLES_HUB_ADDRESS
ENV CIRCLES_HUB_ADDRESS=$CIRCLES_HUB_ADDRESS

ARG SAFE_PROXY_FACTORY_ADDRESS
ENV SAFE_PROXY_FACTORY_ADDRESS=$SAFE_PROXY_FACTORY_ADDRESS

ARG SAFE_ADDRESS
ENV SAFE_ADDRESS=$SAFE_ADDRESS

ARG RPC_ENDPOINT
ENV RPC_ENDPOINT=$RPC_ENDPOINT

ARG OPENLOGIN_CLIENT_ID
ENV OPENLOGIN_CLIENT_ID=$OPENLOGIN_CLIENT_ID

ARG HERE_API_KEY
ENV HERE_API_KEY=$HERE_API_KEY

ARG PLACES_API_KEY
ENV PLACES_API_KEY=$PLACES_API_KEY

ARG IS_PRODUCTION
ENV IS_PRODUCTION=$IS_PRODUCTION

ARG USE_MOCKS
ENV USE_MOCKS=$USE_MOCKS

ARG SHOW_LANGUAGE_SWITCHER
ENV SHOW_LANGUAGE_SWITCHER=$SHOW_LANGUAGE_SWITCHER

RUN git clone https://github.com/CirclesUBI/o-platform.git
WORKDIR /o-platform
RUN git checkout dev
RUN ./build.sh

FROM nginx:latest
COPY --from=builder /o-platform/shell/public /usr/share/nginx/html
