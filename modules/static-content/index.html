<html DOCTYPE="html" lang="en">
<head>
    <title>Status</title>
    <style>
        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            font-size: 14px;
            line-height: 1.42857143;
            color: #333;
            background-color: #fff;
        }
    </style>
    <script>

        function reloadPreview() {
            const apiPreview = document.getElementById('api-preview')
            apiPreview.src = apiPreview.src

            const frontendPreview = document.getElementById('frontend-preview')
            frontendPreview.src = frontendPreview.src

            const invitation = document.getElementById('invitation');
            invitation.innerHTML = `<img src="https://static.circlesubi.localhost/Person_1.png" />`
        }

        async function loadAddresses() {
            const response = await fetch('/addresses.json')
            const addresses = await response.json()
            const contractAddresses = document.getElementById('contractAddresses')
            contractAddresses.innerHTML = JSON.stringify(addresses, null, 2);

            // fetch 'key_phrase.txt'
            const response2 = await fetch('/key_phrase.txt')
            const keyPhrase = await response2.text()
            const keyPhraseElement = document.getElementById('keyPhrase')
            keyPhraseElement.innerHTML = keyPhrase;

            let template = `
EXTERNAL_DOMAIN="localhost"
CONNECTION_STRING_RO="postgresql://postgres:postgres@localhost/api"
APP_ID="api-server-docker"
APP_URL="http://localhost:8080"
ACCEPTED_ISSUER="dev.auth.circles.name"
CORS_ORIGINS="http://localhost:8080"
CONNECTION_STRING_RW="postgresql://postgres:postgres@localhost/api"
DEBUG="true"
BLOCKCHAIN_INDEX_DB_CONNECTION_STRING="postgresql://postgres:postgres@localhost:5433/index"
BLOCKCHAIN_INDEX_WS_URL="ws://localhost:8675"
BUCKET_ENDPOINT="fra1.digitaloceanspaces.com"
RPC_GATEWAY_URL="http://localhost:8545"
DELAY_START="0"
INVITE_EOA="${addresses.defaultOwnerAccount.address}"
INVITE_EOA_KEY="${addresses.defaultOwnerAccount.privateKey}"
OPERATOR_ORGANISATION_ADDRESS="${addresses.operatorOrgaSafeContract}"
INVITATION_FUNDS_SAFE_ADDRESS="${addresses.invitationFundsSafeContract}"
INVITATION_FUNDS_SAFE_KEY="${addresses.defaultOwnerAccount.privateKey}"
PATHFINDER_URL="http://localhost:8081"
S3_AVATAR_FILES_BUCKET_ENDPOINT="http://localhost:9000"
S3_AVATAR_FILES_BUCKET_NAME="avatar-images"
S3_AVATAR_FILES_BUCKET_PUBLIC_URL_PREFIX="http://localhost:9000/avatar-images/"
S3_AVATAR_FILES_BUCKET_KEY_ID="admin"
S3_AVATAR_FILES_BUCKET_KEY_SECRET="1234567890"
`;

            const envFileElement = document.getElementById('envFile')
            envFileElement.innerHTML = template;
        }

        function toggleStatus() {
            const addresses = document.getElementById('contractAddresses')
            if (addresses.style.display === 'none') {
                addresses.style.display = 'block'
            } else {
                addresses.style.display = 'none'
            }

            const toggleStatusIndicator = document.getElementById('toggleStatusIndicator')
            if (toggleStatusIndicator.innerHTML === '[-]') {
                toggleStatusIndicator.innerHTML = '[+]'
            } else {
                toggleStatusIndicator.innerHTML = '[-]'
            }
        }

        setInterval(() => {
            reloadPreview();
            loadAddresses();
        }, 10000);

        // on loaded execute
        document.addEventListener('DOMContentLoaded', function() {
            reloadPreview();
            loadAddresses();
        });
    </script>
</head>
<body>
<fieldset name="preview">
    <legend>Preview</legend>
    <fieldset name="api-preview" style="display: inline-block; width: 45%;">
        <legend>API Preview</legend>
            <iframe id="api-preview" src="https://api-server.circlesubi.localhost" width="100%" height="300" style="border: none;"></iframe>
    </fieldset>
    <fieldset name="o-platform-preview" style="display: inline-block; width: 45%">
        <legend>Frontend Preview</legend>
            <iframe id="frontend-preview" src="https://o-platform.circlesubi.localhost/" width="100%" height="300" style="border: none;"></iframe>
    </fieldset>
</fieldset>
<fieldset name="addresses">
    <legend>Contract addresses <a onclick="toggleStatus()"><span><b id="toggleStatusIndicator" style="cursor: pointer;">[+]</b></span></a> </legend>
    <pre id="contractAddresses" style="display: none;">
    </pre>
</fieldset>
<fieldset name="keyphrase">
    <legend>Keyphrase</legend>
    <pre id="keyPhrase">
    </pre>
</fieldset>
<fieldset name="envFile">
    <legend>Env file</legend>
    <pre id="envFile">
    </pre>
</fieldset>
<fieldset name="invitation">
    <legend>Invitation PNG</legend>
    <div id="invitation">
    </div>
</fieldset>
</body>
</html>
